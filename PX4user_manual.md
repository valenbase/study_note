# PX4不完全使用手册
### [源码地址链接](https://github.com/PX4/Firmware)
## Overview
* <b>环境搭建</b>
	* cmake
	* gcc
	* ninja
***
* <b>编译连接</b>
	* makefile文件
	* cmakelist文件
***
* <b>启动脚本</b>
	* 编译模块
	* 传感器
	* 机型特性相关
	* 通信设备
	* 串口的作用
	* SD卡
***
* <b>驱动</b>
	* linux驱动
	* 操作系统级
***
* <b>功能模块</b>
	* commander
	* navigator
	* posctl
	* mavlink
	* uORB
***
##北航课件学习

* 起落架的作用
	>1、支撑；2、避免桨距离地面过近而发生碰撞；3、减少落地时的地面效应；4、消耗和吸收多旋翼在着地时的冲击力

* 涵道
	>1、保护桨叶和人身安全；2、提高升力效应；3、较少噪音；工作原理是，进风口内壁空气速度快静压小，而进风口外壁静压大，因此涵道能产生附加升力。

* 螺旋桨
	>1、直接产生推力；2、匹配的电机、电调、螺旋桨可以提高效率，提高续航时间；3、假设螺旋桨在不流动的介质中旋转，那么螺旋桨每转一圈，就会向前移动一个距离，成为螺距，桨叶的角度越大，螺距就越大，螺旋桨参数为4个数字，前两个是直径，后两个是螺距；4、转动惯量越小，控制起来更灵敏，并且改变转速所消耗的能量就越小，提高飞行效率。5、转速rpm(revolutions per minute,转/分钟)；6、材料，碳纤维<b>刚性</b>较好，产生振动和噪声较小；更轻，强度更大；适合用于高KV值电机，控制响应比较迅速；木浆适用于较大在中的多旋翼。7、<b>静平衡和动平衡的目的是减少振动</b>,静平衡是螺旋桨重心与周鑫线重合时的平衡状态，动平衡是指螺旋桨重心与其惯性重心重合时的平衡状态，通过贴透明胶或者砂纸打磨非边缘处平面来实现平衡。

* 电机
	> 多旋翼的电机主要以无刷直流电机位置，将电能转换为机械能。无刷直流电机运转时，靠电子电路幻想，这样就极大减少了电火花对遥控无线电设备的干扰，也减少了噪声。
	> 
	> 电机的尺寸用四个数字表示，前两位表示转子的直径，后两位表示转子的高度。
	> 
	> 空载KV值，无刷电机KV值定义为转速/伏特，意思为输入电压增加1伏特，无刷电机空载转速增加的转速。

* 电调
	> 电调全称电子调速器，Electronic speed control 简称ESC。最基本的功能是电机调速；充当换相器的角色。
	> 
	> 无刷电调最主要的参数是电调的功率，通常是A安数来表示，安数不足会导致电调甚至电机烧毁。
	> 
	> 无刷电调有持续电流和X秒呢瞬时电流两个重要参数，前者表示正常时的电流，后者表示X秒呢的容忍的最大电流。
	> 
	> 选择电调时，一定要注意电调的最大电流，否则容易烧毁。
	> 
	> 电机的相应速度与电调的刷新速率有很大关系。
	> 
	> 电调包含方波驱动和正弦波驱动，方波是数字信号，控制元件工作在开关状态，电路简单发热小。数字信号容易控制，正弦波属于模拟信号，模拟信号控制相当复杂，而且控制元件工作在放大状态发热厉害。
	> 
	> 正弦波驱动在运动平衡性，调速范围和减少噪声振动等要好很多。矢量控制，field oriented control
	> 
	> 电池的容量是用毫安时来表示的，5000毫安时的电池表示该电池以5000的电流放点可以持续一小时。但是，随着放点过程的进行，电池的放电能力在下降，其输出电压会缓慢下降，蓑衣导致其剩余容量与放电时间并非是线性关系。
	> 
	> 在实际飞行中，有两种方式可以检测电池的剩余容量，一种是检测单节电池的电压，另一种方式是实时检测电池输出电流做积分。满电电压4.2V，放电完毕3.0V，一般无人机电量到3.6V

	>飞控的PWM输出与电调的频率要符合，低于电调频率的PWM，飞控都可以解析，但是高于的时候，就无法正常执行，导致飞机飞行不稳。

* 螺旋桨安装
	>单桨和共轴双桨，共轴双桨的优点是在不改变多旋翼整体尺寸，增加了载重量；缺点会降低桨的工作效率，双桨大概相当于1.6个桨
	>
	>桨盘的安装可以使水平的，也可以是倾斜的，当处于倾斜安装时候，飞机处于水平姿态时就可以前后飞行。
	>
	>桨盘安装于桨的上下，桨盘安装于机臂上方时：螺旋桨产生拉力，着陆阶段不易碰到障碍，遮挡相机视野小；桨盘位于机臂下方：螺旋桨产生推力，下洗气流完整，防雨，气流低于飞控气压计高度准确，不脱浆。
	>
	>机体半径R与旋翼最大半径rmax之间关系（theta表示轴间夹角），R = {1 + 1/(sin(theta/2))} * rmax
	>
	>减小多旋翼集体尺寸对多旋翼惯性、有效负载有很大影响并且最终影响最大可达角加速度和线加速度。马赫常数限制，弗拉德数限制。
	>
	>多旋翼的中心应该在多旋翼的中心轴上，如果多旋翼重心在桨平面下方，那么阻力形成的力矩会促使多旋翼俯仰角专项0度方向。如果多旋翼重心在桨平面上，那么阻力形成的力矩会使多旋翼俯仰角朝发散方向发展，因此，当多旋翼前飞时，重心在桨平面下方会稳定。当阵风吹来的时候重心的位置情况正好与飞行时候的现象相反。<b>结论:无论重心在上还是在下，飞机飞行都是不稳定的，需要采用反馈控制器飞行，建议在周围稍微靠下一点</b>

* 集体结构设计
	>刚度强度满足负载要求，集体不会发生晃动、弯曲；满足其他设计要求，越轻越好，震动越小越好
	>
	>减震意义：加速度信号直接关系到姿态角和姿态角速率的估计；加速度传感器一般都配有机械或数字的低通滤波。
	>
	>震动来源：机体震动主要来源于机架变形、电机和螺旋桨不对称。机架变形特别是机臂变形导致产生异步震动，所以机臂的刚度越大越好。
	>
	>桨夹需要和电机轴承、螺旋桨中心共轴，避免电机转动时产生偏心力。
	>
	>低速大桨相比于高速小桨的效率更高，但是震动大。
	>
	>震动强度要求，水平向震动0.3g，垂直向震动0.5g，实际工程中要求震动在+-0.1g之内。
	>
	>若是以上的问题都考虑了，那么只需要再考虑飞控板与机架之间的凝胶和泡沫隔震了。
	>
	>目前已经通过的隔震方案：Dubro泡沫、凝胶垫、O形环悬挂安装和耳塞式安装。

* 飞行噪声减噪措施
	>降低叶尖相对马赫数，因为叶尖相对马赫数对螺旋桨辐射噪声的影响极为重大
	>
	>增加螺旋桨桨叶数目，这样可以在保持拉力和功率的前提下，减小螺旋桨外径，从而达到降低叶尖相对马赫数的目的
	>
	>改进延展向桨叶形状，从噪声的声功率分布来看，叶尖部位最高
	>
	>减小桨叶的总面积

* 动力系统
	>动力系统参数：螺旋桨直径，螺距，桨叶数，叶片平均气动弦长，重量，<b>螺旋桨拉力系数CT和转矩系数CM</b>;电机空载电流，电压，标称空载KV值；电调，最大电流，内阻，重量；电池，容量，内阻，总电压，<b>最大放电倍率</b>，重量。
	>
	>设某一电机输入功率一定，当电机具有大KV值时，相同输入电压下会产生大转速，但在电流一定的情况下产生的转矩小，故我们选用小桨。另一方面，当电机具有小KV值时，会产生小转速，大转矩，所以选择大桨。

* 坐标系和姿态角
	>地球表面惯性坐标系，在地面上选一个点作为起飞位置，先让X轴<b>（拇指）</b>在水平的某个方向，Z轴垂直于地面向下，按右手定则确定Y轴。
	>
	>机体坐标系，原点位于多旋翼的重心，X轴<b>（拇指）</b>指向机头方向，Z轴在飞机平面内垂直X轴向下，然后确定Y轴
	>
	>欧拉角的定义，滚转角向右滚转时形成的角度为正，俯仰角向上俯仰时形成的角度为正，偏航角度向右转时为正
	>
	>机体坐标系与地面惯性坐标系之间的夹角就是飞机的姿态角，又称欧拉角。俯仰角：机体轴与地平面之间的夹角，飞机抬头为正；偏航角，机体轴在水平面上的投影与地轴之间的夹角，以机头右偏为正；飞机对称面绕机体轴转过的角度，右为正。